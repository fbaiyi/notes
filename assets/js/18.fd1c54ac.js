(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{382:function(t,e,a){"use strict";a.r(e);var s=a(45),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"transactions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#transactions"}},[t._v("#")]),t._v(" Transactions")]),t._v(" "),a("h3",{attrs:{id:"对比mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对比mysql"}},[t._v("#")]),t._v(" 对比mysql")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("type")]),t._v(" "),a("th",[t._v("mysql")]),t._v(" "),a("th",[t._v("redis")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("开启")]),t._v(" "),a("td",[t._v("start transaction")]),t._v(" "),a("td",[t._v("muitl")])]),t._v(" "),a("tr",[a("td",[t._v("语句")]),t._v(" "),a("td",[t._v("普通sql")]),t._v(" "),a("td",[t._v("普通命令")])]),t._v(" "),a("tr",[a("td",[t._v("失败")]),t._v(" "),a("td",[t._v("rollback")]),t._v(" "),a("td",[t._v("discard")])]),t._v(" "),a("tr",[a("td",[t._v("提交")]),t._v(" "),a("td",[t._v("commit")]),t._v(" "),a("td",[t._v("exec")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("注: rollback与discard 的区别,如果已经成功执行了2条语句, 第3条语句出错.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("Rollback后,前2条的语句影响消失.\nDiscard只是结束本次事务,前2条语句造成的影响仍然还在\n")])])]),a("blockquote",[a("p",[t._v("注:在mutil后面的语句中, 语句出错可能有2种情况")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("1: 语法就有问题, \n这种,exec时,报错, 所有语句得不到执行\n2: 语法本身没错,但适用对象有问题. 比如 zadd 操作list对象\nExec之后,会执行正确的语句,并跳过有不适当的语句.\n")])])]),a("h3",{attrs:{id:"乐观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#乐观锁"}},[t._v("#")]),t._v(" 乐观锁")]),t._v(" "),a("blockquote",[a("p",[t._v("Redis的事务中,启用的是乐观锁,只负责监测key没有被改动")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('redis 127.0.0.1:6379> watch ticket\nOK\nredis 127.0.0.1:6379> multi\nOK\nredis 127.0.0.1:6379> decr ticket\nQUEUED\nredis 127.0.0.1:6379> decrby money 100\nQUEUED\nredis 127.0.0.1:6379> exec\n(nil)   // 返回nil,说明监视的ticket已经改变了,事务就取消了.\nredis 127.0.0.1:6379> get ticket\n"0"\nredis 127.0.0.1:6379> get money\n"200"\n\n\nwatch key1 key2  ... keyN\n作用:监听key1 key2..keyN有没有变化,如果有变, 则事务取消\n\nunwatch \n作用: 取消所有watch监听\n\n')])])])])}),[],!1,null,null,null);e.default=n.exports}}]);